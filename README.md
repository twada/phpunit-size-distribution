# phpunit-size-distribution

[![CI][ci-image]][ci-url]
[![codecov][codecov-image]][codecov-url]
[![Latest Stable Version][packagist-image]][packagist-url]
![PHP Version][php-version-image]
![PHPUnit Version][phpunit-version-image]
![PHPStan Level][phpstan-image]
[![License][license-image]][license-url]

A PHPUnit extension that measures and reports test size distribution (Small/Medium/Large).

## Overview

PHPUnit supports test size classification through `#[Small]`, `#[Medium]`, and `#[Large]` attributes. This extension analyzes your test suite and reports the distribution of test sizes, helping you maintain a healthy test pyramid.

## Requirements

- PHP 8.1+
- PHPUnit 10.5+ / 11.x / 12.x

## Installation

```bash
composer require --dev twada/phpunit-size-distribution
```

## Configuration

Register the extension in your `phpunit.xml`:

```xml
<phpunit>
    <!-- ... -->
    <extensions>
        <bootstrap class="Twada\PHPUnitSizeDistribution\TestSizeReporterExtension"/>
    </extensions>
</phpunit>
```

## Usage

Run your tests as usual:

```bash
vendor/bin/phpunit
```

After test execution, you'll see a report like this:

```
Test Size Distribution
======================
Small:   5 tests ( 62.5%)
Medium:  1 tests ( 12.5%)
Large:   1 tests ( 12.5%)
None:    1 tests ( 12.5%)
----------------------
Total:   8 tests
```

## Test Size Categories

| Category | Description |
|----------|-------------|
| Small | Tests marked with `#[Small]` attribute |
| Medium | Tests marked with `#[Medium]` attribute |
| Large | Tests marked with `#[Large]` attribute |
| None | Tests without any size attribute |

### Example

```php
<?php

use PHPUnit\Framework\Attributes\Small;
use PHPUnit\Framework\TestCase;

#[Small]
final class UserTest extends TestCase
{
    public function testName(): void
    {
        // This test is counted as "Small"
    }
}
```

## Counting Rules

- **Counted:** Passed, Failed, and Errored tests
- **Not counted:** Skipped and Incomplete tests

## Limitations

- **Class-level attributes only**: PHPUnit's size attributes (`#[Small]`, `#[Medium]`, `#[Large]`) can only be applied at the class level, not on individual test methods. All test methods in a class inherit the class's size.

- **DataProvider inheritance**: Test cases generated by DataProviders inherit the size attribute from their test class.

- **No runtime detection**: This extension reads PHPUnit's metadata attributes. It does not measure actual execution time or resource usage.

## Contributing

Contributions are welcome! Please see [CONTRIBUTING.md](CONTRIBUTING.md) for guidelines.

## License

MIT License. See [LICENSE](LICENSE) for details.

## Author

Takuto Wada

[ci-image]: https://github.com/twada/phpunit-size-distribution/actions/workflows/ci.yml/badge.svg
[ci-url]: https://github.com/twada/phpunit-size-distribution/actions/workflows/ci.yml
[codecov-image]: https://codecov.io/gh/twada/phpunit-size-distribution/graph/badge.svg?token=BWM5I94DIH
[codecov-url]: https://codecov.io/gh/twada/phpunit-size-distribution
[packagist-image]: https://poser.pugx.org/twada/phpunit-size-distribution/v
[packagist-url]: https://packagist.org/packages/twada/phpunit-size-distribution
[php-version-image]: https://img.shields.io/badge/php-8.1%2B-blue
[phpunit-version-image]: https://img.shields.io/badge/phpunit-10.5%2B%20%7C%2011.x%20%7C%2012.x-blue
[phpstan-image]: https://img.shields.io/badge/phpstan-level%208-brightgreen
[license-image]: https://img.shields.io/badge/license-MIT-green
[license-url]: LICENSE
